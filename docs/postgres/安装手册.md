## 二进制包安装

> 官网： https://www.postgresql.org/download/linux/redhat/

```shell
# 安装 RPM 存储库：
sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm

sudo yum install -y postgresql14-server

sudo /usr/pgsql-14/bin/postgresql-14-setup initdb
sudo systemctl enable  postgresql-14 --now
~]# ss -tnlp|grep 5432
LISTEN     0      128    127.0.0.1:5432                     *:*                   users:(("postmaster",pid=2410,fd=7))
LISTEN     0      128      [::1]:5432                  [::]:*                   users:(("postmaster",pid=2410,fd=6))
```

## 源码安装

> 官网：https://www.postgresql.org/docs/14/install-short.html

```shell
# 安装依赖
yum install -y gcc make readline-devel zlib-devel bison flex libxml2-devel libxslt-devel openldap-devel pam-devel python3-devel
# 解压编译
wget https://ftp.postgresql.org/pub/source/v14.17/postgresql-14.17.tar.gz
tar -xf postgresql-14.17.tar.gz  && cd postgresql-14.17
./configure --prefix=/usr/local/pgsql-14.17  --with-pgport=5432
make -j 2 world
make install-world
# 创建用户
useradd  -m -d /home/postgres -s /bin/bash postgres
# echo -e 'postgres123\npostgres123'|passwd  postgres
echo postgres:123456|chpasswd 
# 创建数据目录并授权
mkdir /usr/local/pgsql-14.17/data
chown postgres:postgres /usr/local/pgsql-14.17/data
# 设置环境变量
cat > /etc/profile.d/pgsql.sh << 'EOF'
export PGHOME=/usr/local/pgsql-14.17/
export PATH=$PGHOME/bin:$PATH
export PGDATA=$PGHOME/data
export PGUSER=postgres
export MANPATH=$MANPATH:/usr/local/pgsql-14.17/share/man/
EOF

# 初始化数据库
su - postgres
/usr/local/pgsql-14.17/bin/initdb -D /usr/local/pgsql-14.17/data
# 启动数据库
/usr/local/pgsql-14.17/bin/pg_ctl -D /usr/local/pgsql-14.17/data -l logfile start

# 查看数据库版本
~]$ psql
psql (14.17)
Type "help" for help.

postgres=# select version();
                                                 version                                                  
----------------------------------------------------------------------------------------------------------
 PostgreSQL 14.17 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-44), 64-bit
(1 row)
```

## 配置远程连接

```shell title="postgresql.conf"
# 修改主配置文件，监听所有IP
vim /usr/local/pgsql-14.17/data/postgresql.conf 
listen_addresses = '*'


# 需重启服务生效
pg_ctl  restart
```
```shell title="pg_hba.conf"
# 修改访问控制文件，远程主机进过md5密码验证连接所有数据库
vim /usr/local/pgsql-14.17/data/pg_hba.conf
# TYPE  DATABASE        USER            ADDRESS                 METHOD
# IPv4 remote connections:
host    all             all             0.0.0.0/0               md5
# 需重启服务生效
pg_ctl  restart
```
```shell
# 为 postgres 用户添加密码
~]$ psql 
psql (14.17)
Type "help" for help.

postgres=# ALTER USER postgres with password '123456';
ALTER ROLE

~]$ psql -h 192.168.0.118 db1 postgres
Password for user postgres: 
psql (14.17)
Type "help" for help.

db1=# \c
You are now connected to database "db1" as user "postgres".
```


